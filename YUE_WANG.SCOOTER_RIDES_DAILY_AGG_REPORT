CREATE OR REPLACE TABLE
YUE_WANG.SCOOTER_RIDES_DAILY_AGG_REPORT AS
(
  SELECT START_DATE_UTC,
  COUNT (RIDE_EVENT_ID) AS RIDES_COUNT,
  COUNT(DISTINCT RIDER_ID ) AS UNIQUE_USER_COUNT,
  COUNT(DISTINCT SCOOTER_ID)AS UNIQUE_SCOOTER_COUNT,
   --ROLLING AVERAGE OF RIDES--
  AVG(RIDES_COUNT) OVER (ORDER BY START_DATE_UTC ROWS BETWEEN 6 PRECEDING AND CURRENT ROW) AS MOVING_AVERAGE_RIDES_7,
  AVG(RIDES_COUNT) OVER (ORDER BY START_DATE_UTC ROWS BETWEEN 29 PRECEDING AND CURRENT ROW) AS MOVING_AVERAGE_RIDES_30,
  AVG(UNIQUE_USER_COUNT) OVER (ORDER BY START_DATE_UTC ROWS BETWEEN 6 PRECEDING AND CURRENT ROW) AS MOVING_AVERAGE_USERS_7,
  AVG(UNIQUE_USER_COUNT) OVER (ORDER BY START_DATE_UTC ROWS BETWEEN 29 PRECEDING AND CURRENT ROW) AS MOVING_AVERAGE_USERS_30,
  AVG(RIDE_DURATION_MINS) AS AVERAGE_RIDING_TIME,
  AVG(FEEDBACK_RATING) AS AVERAGE_FEEDBACK_RATING
  FROM APPLICANTS.YUE_WANG.RIDE_CORE
  GROUP BY 1
  ORDER BY 1 DESC
);

SELECT * FROM YUE_WANG.SCOOTER_RIDES_DAILY_AGG_REPORT
